global  
        daemon
  
defaults  
        log global  
        mode    http  
        timeout connect 5000  
        timeout client 5000  
        timeout server 5000  
  
frontend main  
        bind *:80  
        filter spoe engine ip-reputation config /usr/local/etc/haproxy/iprep.conf
        default_backend app  
  
backend app  
        balance roundrobin  
        mode http  
        server srv1 web:5000
        http-response set-header x-abc %[var(sess.iprep.ip_score)]
    #tcp-request content reject if { var(sess.iprep.ip_score) -m int lt 20 }

backend agents
    mode tcp
    balance roundrobin
    timeout connect 5s  # greater than hello timeout
    timeout server  3m  # greater than idle timeout
    option spop-check
    server agent1 spoa:9000 check
